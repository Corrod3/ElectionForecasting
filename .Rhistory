AfDShares <- data.frame(Parties = rep("AfD", 3), gndr = c("Total", "Male", "Female"),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)), stringsAsFactors = FALSE)
VoteAgeGndr.2013 <- data.frame(rbind(as.matrix(VoteAgeGndr.2013), as.matrix(AfDShares)),
stringsAsFactors = FALSE)
VoteAgeGndr.2013[,c(3:8)] <- sapply(VoteAgeGndr.2013[,c(3:8)], as.double)
VoteAgeGndr.2013[VoteAgeGndr.2013$Parties == "AfD", c(3:8)] <-
VoteAgeGndr.2013[VoteAgeGndr.2013$Parties == "Other", c(3:8)]*(as.double(AfD))
VoteAgeGndr.2013[VoteAgeGndr.2013$Parties == "Other", c(3:8)] <-
VoteAgeGndr.2013[VoteAgeGndr.2013$Parties == "Other", c(3:8)]*(1-as.double(AfD))
# combine CDU/CSU
VoteAgeGndr.2013 <- VoteAgeGndr.2013 %>% mutate(
Parties = str_replace(Parties, "CDU|CSU", "Union")
) %>% group_by(gndr, Parties) %>%
summarise_all(sum) %>% filter(gndr != "Total")
# reshape
Strata.1.ExitPoll <- select(VoteAgeGndr.2013, -GndrVote) %>%
gather(key = "AgeGroup", value = "VoteShare", starts_with("age"))
Strata.1.ExitPoll$AgeGroup <- mapvalues(Strata.1.ExitPoll$AgeGroup,
c("age18_25.2013", "age26_35.2013", "age36_45.2013", "age46_60.2013", "age60..2013"),
c("18-25", "26-35", "36-45", "46-60", "60+"))
Strata.1.ExitPoll$VoteShare <- Strata.1.ExitPoll$VoteShare*100
Strata.1.ExitPoll <- rename(Strata.1.ExitPoll, VoteShareExit = VoteShare)
Strata.1.March <- rename(
Strata.1.March, Parties = vote_nextelection_de, VoteShareDalia = n)
### compute weights
exitPollWeights <- left_join(Strata.1.ExitPoll, Strata.1.March, by = c("gndr", "Parties", "AgeGroup"))
exitPollWeights$wtGndrAgeParty <- (exitPollWeights$VoteShareExit)/exitPollWeights$VoteShareDalia
exitPollWeights <- rename(exitPollWeights, vote_nextelection_de = Parties)
# assign weights to Dalia data
Dalia.March <- left_join(Dalia.March, exitPollWeights, by = c("gndr", "vote_nextelection_de", "AgeGroup"))
### graph with new weights ----------------------------------------------------
position <- c("Union", "SPD", "Gruene", "Linke", "FDP", "AfD", "Other")
p1 <- Dalia.March %>% filter(vote_nextelection_de != "No vote") %>%
ggplot(mapping = aes(x = vote_nextelection_de)) +
theme_classic() +
scale_x_discrete(limits = rev(position), name = "Major Parties") +
scale_y_continuous(name = "Overall Vote Share", limits = c(0,0.42),
breaks = c(0, 0.1, 0.2, 0.3, 0.4),
labels = percent)
#coord_flip()
p1.unweighted <- p1 +
geom_bar(aes(y = ..prop.., group = 1), fill = "cadetblue3", width = 0.8)
p1.weighted <- p1 +
geom_bar(aes(weight = wtGndrAgeParty,
y = ..prop.., group = 1), labels = percent,
fill = "cadetblue3",
width = 0.8) +
geom_text(aes(label = ..count.., y= ..prop..), stat= "count", vjust = -.5)
grid.arrange(p1.unweighted, p1.weighted, ncol = 2)
# Clear Global environment
rm(list=ls())
## Setting Working directory
try(setwd("D:/Eigene Datein/Dokumente/Uni/Hertie/Materials/Election Forecasting/ElectionForecasting"), silent = TRUE)
try(setwd("C:\\Users\\Moritz\\Desktop\\ElectionForecasting"), silent = TRUE)
source("packages.R")
### March data ----------------------------------------------------------------
# load
Dalia.March <- read_csv("./Raw/March_Wave/data_coded_HertieSchool of Governance_2017-04-11_10-20.csv")
# create variable names
var.names <- names(Dalia.March) %>% str_replace("(.+Q\\d+_)|(\\[.+\\]\\s)", "") %>%
str_replace("\\s.+", "") %>%
str_replace("_[A-Z].+.|\\d", "") %>%
str_replace("\\]", "")
colnames(Dalia.March) <- var.names
colnames(Dalia.March)[8] <- c("gndr")
# interesting vars: opinion_eu, opinion_government, political_views, likelihood_to_demonstrate
# frequency_of_voting, vote_next_national_election, vote_nextelection_de, voted_party_last_election_de,
# certainty_party_to_vote, ranking_party_de, bundeskanzler_candidate, frequent_sharing_of_politicalviews
# clean NAs (might be interesting to look for a pattern in NAs in this question)
Dalia.March <- Dalia.March %>% filter(!is.na(vote_nextelection_de))
# rename variables
Dalia.March$vote_nextelection_de <- str_replace(Dalia.March$vote_nextelection_de,
"(\\s.+lands)|(\\s.+land)|(CDU.+le\\s)|(Die\\s)|(\\s.+Partei)|(B.+Die\\s)",
"")
Dalia.March$vote_nextelection_de <- str_replace(Dalia.March$vote_nextelection_de,
"Gr端nen", "Gruene")
Dalia.March$vote_nextelection_de <- str_replace(Dalia.March$vote_nextelection_de,
"I would not vote", "No vote")
Dalia.March$gndr <- Dalia.March$gndr %>% mapvalues(c("female", "male"), c("Female", "Male"))
# Dalia.March$bundeskanzler_candidate %>% table()
# Dalia.March$vote_nextelection_de %>% table()
### March data mining ---------------------------------------------------------
# Charts
ggplot(data = Dalia.March, mapping = aes(x = vote_nextelection_de, weight = weight)) +
geom_bar()
ggplot(data = Dalia.March, mapping = aes(x = vote_nextelection_de)) +
geom_bar(aes(fill = gndr))
ggplot(data = Dalia.March, mapping = aes(x = fct_infreq(vote_nextelection_de))) +
geom_bar(aes(fill = certainty_party_to_vote))
# -> Dalia weights cause hardly any changes
### Strata construction Dalia march -------------------------------------------------
Dalia.March$AgeGroup <- c("18-25", "26-35",
"36-45", "46-60", "60+")[findInterval(Dalia.March$age,
c(-Inf, 25.5, 35.5, 45.5, 60.5, Inf))]
Strata.1.March <- Dalia.March %>% filter(vote_nextelection_de != "No vote") %>%
group_by(gndr, AgeGroup, vote_nextelection_de) %>%
tally()
# strata percentages
Strata.1.March$n <- 100*(Strata.1.March$n/sum(Strata.1.March$n))
### Exit poll Strata ----------------------------------------------------------
# load weighting data
load("./Processed/Vote_Age_Gender_2013.RData")
load("./Processed/Total_2013.RData")
# AfD - share of total "Others"
AfD <- total.2013[8,"Zweitstimmen_pct"]/(total.2013[8,"Zweitstimmen_pct"]+
total.2013[6,"Zweitstimmen_pct"])
# compute AfD share from their total vote share across all "Other" parties:
# assumption: Distribution of voters across age groups AND gender equal
# alternative solution: collect demographics of AfD voter data
AfDShares <- data.frame(Parties = rep("AfD", 3), gndr = c("Total", "Male", "Female"),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)), stringsAsFactors = FALSE)
VoteAgeGndr.2013 <- data.frame(rbind(as.matrix(VoteAgeGndr.2013), as.matrix(AfDShares)),
stringsAsFactors = FALSE)
VoteAgeGndr.2013[,c(3:8)] <- sapply(VoteAgeGndr.2013[,c(3:8)], as.double)
VoteAgeGndr.2013[VoteAgeGndr.2013$Parties == "AfD", c(3:8)] <-
VoteAgeGndr.2013[VoteAgeGndr.2013$Parties == "Other", c(3:8)]*(as.double(AfD))
VoteAgeGndr.2013[VoteAgeGndr.2013$Parties == "Other", c(3:8)] <-
VoteAgeGndr.2013[VoteAgeGndr.2013$Parties == "Other", c(3:8)]*(1-as.double(AfD))
# combine CDU/CSU
VoteAgeGndr.2013 <- VoteAgeGndr.2013 %>% mutate(
Parties = str_replace(Parties, "CDU|CSU", "Union")
) %>% group_by(gndr, Parties) %>%
summarise_all(sum) %>% filter(gndr != "Total")
# reshape
Strata.1.ExitPoll <- select(VoteAgeGndr.2013, -GndrVote) %>%
gather(key = "AgeGroup", value = "VoteShare", starts_with("age"))
Strata.1.ExitPoll$AgeGroup <- mapvalues(Strata.1.ExitPoll$AgeGroup,
c("age18_25.2013", "age26_35.2013", "age36_45.2013", "age46_60.2013", "age60..2013"),
c("18-25", "26-35", "36-45", "46-60", "60+"))
Strata.1.ExitPoll$VoteShare <- Strata.1.ExitPoll$VoteShare*100
Strata.1.ExitPoll <- rename(Strata.1.ExitPoll, VoteShareExit = VoteShare)
Strata.1.March <- rename(
Strata.1.March, Parties = vote_nextelection_de, VoteShareDalia = n)
### compute weights
exitPollWeights <- left_join(Strata.1.ExitPoll, Strata.1.March, by = c("gndr", "Parties", "AgeGroup"))
exitPollWeights$wtGndrAgeParty <- (exitPollWeights$VoteShareExit)/exitPollWeights$VoteShareDalia
exitPollWeights <- rename(exitPollWeights, vote_nextelection_de = Parties)
# assign weights to Dalia data
Dalia.March <- left_join(Dalia.March, exitPollWeights, by = c("gndr", "vote_nextelection_de", "AgeGroup"))
### graph with new weights ----------------------------------------------------
position <- c("Union", "SPD", "Gruene", "Linke", "FDP", "AfD", "Other")
p1 <- Dalia.March %>% filter(vote_nextelection_de != "No vote") %>%
ggplot(mapping = aes(x = vote_nextelection_de)) +
theme_classic() +
scale_x_discrete(limits = rev(position), name = "Major Parties") +
scale_y_continuous(name = "Overall Vote Share", limits = c(0,0.42),
breaks = c(0, 0.1, 0.2, 0.3, 0.4),
labels = percent)
#coord_flip()
p1.unweighted <- p1 +
geom_bar(aes(y = ..prop.., group = 1), fill = "cadetblue3", width = 0.8)
p1.weighted <- p1 +
geom_bar(aes(weight = wtGndrAgeParty,
y = ..prop.., group = 1),
fill = "cadetblue3",
width = 0.8) +
geom_text(aes(label = ..count.., y= ..prop..), stat= "count", vjust = -.5)
grid.arrange(p1.unweighted, p1.weighted, ncol = 2)
# Clear Global environment
rm(list=ls())
## Setting Working directory
try(setwd("D:/Eigene Datein/Dokumente/Uni/Hertie/Materials/Election Forecasting/ElectionForecasting"), silent = TRUE)
try(setwd("C:\\Users\\Moritz\\Desktop\\ElectionForecasting"), silent = TRUE)
source("packages.R")
### March data ----------------------------------------------------------------
# load
Dalia.March <- read_csv("./Raw/March_Wave/data_coded_HertieSchool of Governance_2017-04-11_10-20.csv")
# create variable names
var.names <- names(Dalia.March) %>% str_replace("(.+Q\\d+_)|(\\[.+\\]\\s)", "") %>%
str_replace("\\s.+", "") %>%
str_replace("_[A-Z].+.|\\d", "") %>%
str_replace("\\]", "")
colnames(Dalia.March) <- var.names
colnames(Dalia.March)[8] <- c("gndr")
# interesting vars: opinion_eu, opinion_government, political_views, likelihood_to_demonstrate
# frequency_of_voting, vote_next_national_election, vote_nextelection_de, voted_party_last_election_de,
# certainty_party_to_vote, ranking_party_de, bundeskanzler_candidate, frequent_sharing_of_politicalviews
# clean NAs (might be interesting to look for a pattern in NAs in this question)
Dalia.March <- Dalia.March %>% filter(!is.na(vote_nextelection_de))
# rename variables
Dalia.March$vote_nextelection_de <- str_replace(Dalia.March$vote_nextelection_de,
"(\\s.+lands)|(\\s.+land)|(CDU.+le\\s)|(Die\\s)|(\\s.+Partei)|(B.+Die\\s)",
"")
Dalia.March$vote_nextelection_de <- str_replace(Dalia.March$vote_nextelection_de,
"Gr端nen", "Gruene")
Dalia.March$vote_nextelection_de <- str_replace(Dalia.March$vote_nextelection_de,
"I would not vote", "No vote")
Dalia.March$gndr <- Dalia.March$gndr %>% mapvalues(c("female", "male"), c("Female", "Male"))
# Dalia.March$bundeskanzler_candidate %>% table()
# Dalia.March$vote_nextelection_de %>% table()
### March data mining ---------------------------------------------------------
# Charts
ggplot(data = Dalia.March, mapping = aes(x = vote_nextelection_de, weight = weight)) +
geom_bar()
ggplot(data = Dalia.March, mapping = aes(x = vote_nextelection_de)) +
geom_bar(aes(fill = gndr))
ggplot(data = Dalia.March, mapping = aes(x = fct_infreq(vote_nextelection_de))) +
geom_bar(aes(fill = certainty_party_to_vote))
# -> Dalia weights cause hardly any changes
### Strata construction Dalia march -------------------------------------------------
Dalia.March$AgeGroup <- c("18-25", "26-35",
"36-45", "46-60", "60+")[findInterval(Dalia.March$age,
c(-Inf, 25.5, 35.5, 45.5, 60.5, Inf))]
Strata.1.March <- Dalia.March %>% filter(vote_nextelection_de != "No vote") %>%
group_by(gndr, AgeGroup, vote_nextelection_de) %>%
tally()
# strata percentages
Strata.1.March$n <- 100*(Strata.1.March$n/sum(Strata.1.March$n))
### Exit poll Strata ----------------------------------------------------------
# load weighting data
load("./Processed/Vote_Age_Gender_2013.RData")
load("./Processed/Total_2013.RData")
# AfD - share of total "Others"
AfD <- total.2013[8,"Zweitstimmen_pct"]/(total.2013[8,"Zweitstimmen_pct"]+
total.2013[6,"Zweitstimmen_pct"])
# compute AfD share from their total vote share across all "Other" parties:
# assumption: Distribution of voters across age groups AND gender equal
# alternative solution: collect demographics of AfD voter data
AfDShares <- data.frame(Parties = rep("AfD", 3), gndr = c("Total", "Male", "Female"),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)), stringsAsFactors = FALSE)
VoteAgeGndr.2013 <- data.frame(rbind(as.matrix(VoteAgeGndr.2013), as.matrix(AfDShares)),
stringsAsFactors = FALSE)
VoteAgeGndr.2013[,c(3:8)] <- sapply(VoteAgeGndr.2013[,c(3:8)], as.double)
VoteAgeGndr.2013[VoteAgeGndr.2013$Parties == "AfD", c(3:8)] <-
VoteAgeGndr.2013[VoteAgeGndr.2013$Parties == "Other", c(3:8)]*(as.double(AfD))
VoteAgeGndr.2013[VoteAgeGndr.2013$Parties == "Other", c(3:8)] <-
VoteAgeGndr.2013[VoteAgeGndr.2013$Parties == "Other", c(3:8)]*(1-as.double(AfD))
# combine CDU/CSU
VoteAgeGndr.2013 <- VoteAgeGndr.2013 %>% mutate(
Parties = str_replace(Parties, "CDU|CSU", "Union")
) %>% group_by(gndr, Parties) %>%
summarise_all(sum) %>% filter(gndr != "Total")
# reshape
Strata.1.ExitPoll <- select(VoteAgeGndr.2013, -GndrVote) %>%
gather(key = "AgeGroup", value = "VoteShare", starts_with("age"))
Strata.1.ExitPoll$AgeGroup <- mapvalues(Strata.1.ExitPoll$AgeGroup,
c("age18_25.2013", "age26_35.2013", "age36_45.2013", "age46_60.2013", "age60..2013"),
c("18-25", "26-35", "36-45", "46-60", "60+"))
Strata.1.ExitPoll$VoteShare <- Strata.1.ExitPoll$VoteShare*100
Strata.1.ExitPoll <- rename(Strata.1.ExitPoll, VoteShareExit = VoteShare)
Strata.1.March <- rename(
Strata.1.March, Parties = vote_nextelection_de, VoteShareDalia = n)
### compute weights
exitPollWeights <- left_join(Strata.1.ExitPoll, Strata.1.March, by = c("gndr", "Parties", "AgeGroup"))
exitPollWeights$wtGndrAgeParty <- (exitPollWeights$VoteShareExit)/exitPollWeights$VoteShareDalia
exitPollWeights <- rename(exitPollWeights, vote_nextelection_de = Parties)
# assign weights to Dalia data
Dalia.March <- left_join(Dalia.March, exitPollWeights, by = c("gndr", "vote_nextelection_de", "AgeGroup"))
### graph with new weights ----------------------------------------------------
position <- c("Union", "SPD", "Gruene", "Linke", "FDP", "AfD", "Other")
p1 <- Dalia.March %>% filter(vote_nextelection_de != "No vote") %>%
ggplot(mapping = aes(x = vote_nextelection_de)) +
theme_classic() +
scale_x_discrete(limits = rev(position), name = "Major Parties") +
scale_y_continuous(name = "Overall Vote Share", limits = c(0,0.42),
breaks = c(0, 0.1, 0.2, 0.3, 0.4),
labels = percent)
#coord_flip()
p1.unweighted <- p1 +
geom_bar(aes(y = ..prop.., group = 1), fill = "cadetblue3", width = 0.8)
p1.weighted <- p1 +
geom_bar(aes(weight = wtGndrAgeParty,
y = ..prop.., group = 1),
fill = "cadetblue3",
width = 0.8) +
geom_text(aes( label = scales::percent(..prop..),
y= ..prop.. ), stat= "count", vjust = -.5)
#geom_text(aes(label = ..count.., y= ..prop..), stat= "count", vjust = -.5)
grid.arrange(p1.unweighted, p1.weighted, ncol = 2)
# Clear Global environment
rm(list=ls())
## Setting Working directory
try(setwd("D:/Eigene Datein/Dokumente/Uni/Hertie/Materials/Election Forecasting/ElectionForecasting"), silent = TRUE)
try(setwd("C:\\Users\\Moritz\\Desktop\\ElectionForecasting"), silent = TRUE)
source("packages.R")
### March data ----------------------------------------------------------------
# load
Dalia.March <- read_csv("./Raw/March_Wave/data_coded_HertieSchool of Governance_2017-04-11_10-20.csv")
# create variable names
var.names <- names(Dalia.March) %>% str_replace("(.+Q\\d+_)|(\\[.+\\]\\s)", "") %>%
str_replace("\\s.+", "") %>%
str_replace("_[A-Z].+.|\\d", "") %>%
str_replace("\\]", "")
colnames(Dalia.March) <- var.names
colnames(Dalia.March)[8] <- c("gndr")
# interesting vars: opinion_eu, opinion_government, political_views, likelihood_to_demonstrate
# frequency_of_voting, vote_next_national_election, vote_nextelection_de, voted_party_last_election_de,
# certainty_party_to_vote, ranking_party_de, bundeskanzler_candidate, frequent_sharing_of_politicalviews
# clean NAs (might be interesting to look for a pattern in NAs in this question)
Dalia.March <- Dalia.March %>% filter(!is.na(vote_nextelection_de))
# rename variables
Dalia.March$vote_nextelection_de <- str_replace(Dalia.March$vote_nextelection_de,
"(\\s.+lands)|(\\s.+land)|(CDU.+le\\s)|(Die\\s)|(\\s.+Partei)|(B.+Die\\s)",
"")
Dalia.March$vote_nextelection_de <- str_replace(Dalia.March$vote_nextelection_de,
"Gr端nen", "Gruene")
Dalia.March$vote_nextelection_de <- str_replace(Dalia.March$vote_nextelection_de,
"I would not vote", "No vote")
Dalia.March$gndr <- Dalia.March$gndr %>% mapvalues(c("female", "male"), c("Female", "Male"))
# Dalia.March$bundeskanzler_candidate %>% table()
# Dalia.March$vote_nextelection_de %>% table()
### March data mining ---------------------------------------------------------
# Charts
ggplot(data = Dalia.March, mapping = aes(x = vote_nextelection_de, weight = weight)) +
geom_bar()
ggplot(data = Dalia.March, mapping = aes(x = vote_nextelection_de)) +
geom_bar(aes(fill = gndr))
ggplot(data = Dalia.March, mapping = aes(x = fct_infreq(vote_nextelection_de))) +
geom_bar(aes(fill = certainty_party_to_vote))
# -> Dalia weights cause hardly any changes
### Strata construction Dalia march -------------------------------------------------
Dalia.March$AgeGroup <- c("18-25", "26-35",
"36-45", "46-60", "60+")[findInterval(Dalia.March$age,
c(-Inf, 25.5, 35.5, 45.5, 60.5, Inf))]
Strata.1.March <- Dalia.March %>% filter(vote_nextelection_de != "No vote") %>%
group_by(gndr, AgeGroup, vote_nextelection_de) %>%
tally()
# strata percentages
Strata.1.March$n <- 100*(Strata.1.March$n/sum(Strata.1.March$n))
### Exit poll Strata ----------------------------------------------------------
# load weighting data
load("./Processed/Vote_Age_Gender_2013.RData")
load("./Processed/Total_2013.RData")
# AfD - share of total "Others"
AfD <- total.2013[8,"Zweitstimmen_pct"]/(total.2013[8,"Zweitstimmen_pct"]+
total.2013[6,"Zweitstimmen_pct"])
# compute AfD share from their total vote share across all "Other" parties:
# assumption: Distribution of voters across age groups AND gender equal
# alternative solution: collect demographics of AfD voter data
AfDShares <- data.frame(Parties = rep("AfD", 3), gndr = c("Total", "Male", "Female"),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)), stringsAsFactors = FALSE)
VoteAgeGndr.2013 <- data.frame(rbind(as.matrix(VoteAgeGndr.2013), as.matrix(AfDShares)),
stringsAsFactors = FALSE)
VoteAgeGndr.2013[,c(3:8)] <- sapply(VoteAgeGndr.2013[,c(3:8)], as.double)
VoteAgeGndr.2013[VoteAgeGndr.2013$Parties == "AfD", c(3:8)] <-
VoteAgeGndr.2013[VoteAgeGndr.2013$Parties == "Other", c(3:8)]*(as.double(AfD))
VoteAgeGndr.2013[VoteAgeGndr.2013$Parties == "Other", c(3:8)] <-
VoteAgeGndr.2013[VoteAgeGndr.2013$Parties == "Other", c(3:8)]*(1-as.double(AfD))
# combine CDU/CSU
VoteAgeGndr.2013 <- VoteAgeGndr.2013 %>% mutate(
Parties = str_replace(Parties, "CDU|CSU", "Union")
) %>% group_by(gndr, Parties) %>%
summarise_all(sum) %>% filter(gndr != "Total")
# reshape
Strata.1.ExitPoll <- select(VoteAgeGndr.2013, -GndrVote) %>%
gather(key = "AgeGroup", value = "VoteShare", starts_with("age"))
Strata.1.ExitPoll$AgeGroup <- mapvalues(Strata.1.ExitPoll$AgeGroup,
c("age18_25.2013", "age26_35.2013", "age36_45.2013", "age46_60.2013", "age60..2013"),
c("18-25", "26-35", "36-45", "46-60", "60+"))
Strata.1.ExitPoll$VoteShare <- Strata.1.ExitPoll$VoteShare*100
Strata.1.ExitPoll <- rename(Strata.1.ExitPoll, VoteShareExit = VoteShare)
Strata.1.March <- rename(
Strata.1.March, Parties = vote_nextelection_de, VoteShareDalia = n)
### compute weights
exitPollWeights <- left_join(Strata.1.ExitPoll, Strata.1.March, by = c("gndr", "Parties", "AgeGroup"))
exitPollWeights$wtGndrAgeParty <- (exitPollWeights$VoteShareExit)/exitPollWeights$VoteShareDalia
exitPollWeights <- rename(exitPollWeights, vote_nextelection_de = Parties)
# assign weights to Dalia data
Dalia.March <- left_join(Dalia.March, exitPollWeights, by = c("gndr", "vote_nextelection_de", "AgeGroup"))
### graph with new weights ----------------------------------------------------
position <- c("Union", "SPD", "Gruene", "Linke", "FDP", "AfD", "Other")
p1 <- Dalia.March %>% filter(vote_nextelection_de != "No vote") %>%
ggplot(mapping = aes(x = vote_nextelection_de)) +
theme_classic() +
scale_x_discrete(limits = rev(position), name = "Major Parties") +
scale_y_continuous(name = "Overall Vote Share", limits = c(0,0.42),
breaks = c(0, 0.1, 0.2, 0.3, 0.4),
labels = percent)
#coord_flip()
p1.unweighted <- p1 +
geom_bar(aes(y = ..prop.., group = 1), fill = "cadetblue3", width = 0.8)
p1.weighted <- p1 +
geom_bar(aes(weight = wtGndrAgeParty,
y = ..prop.., group = 1),
fill = "cadetblue3",
width = 0.8) +
#geom_text(aes(label = scales::percent(..prop..),
#               y= ..prop.. ), stat= "count", vjust = -.5)
#geom_text(aes(label = ..count.., y= ..prop..), stat= "count", vjust = -.5)
grid.arrange(p1.unweighted, p1.weighted, ncol = 2)
# Clear Global environment
rm(list=ls())
## Setting Working directory
try(setwd("D:/Eigene Datein/Dokumente/Uni/Hertie/Materials/Election Forecasting/ElectionForecasting"), silent = TRUE)
try(setwd("C:\\Users\\Moritz\\Desktop\\ElectionForecasting"), silent = TRUE)
source("packages.R")
### March data ----------------------------------------------------------------
# load
Dalia.March <- read_csv("./Raw/March_Wave/data_coded_HertieSchool of Governance_2017-04-11_10-20.csv")
# create variable names
var.names <- names(Dalia.March) %>% str_replace("(.+Q\\d+_)|(\\[.+\\]\\s)", "") %>%
str_replace("\\s.+", "") %>%
str_replace("_[A-Z].+.|\\d", "") %>%
str_replace("\\]", "")
colnames(Dalia.March) <- var.names
colnames(Dalia.March)[8] <- c("gndr")
# interesting vars: opinion_eu, opinion_government, political_views, likelihood_to_demonstrate
# frequency_of_voting, vote_next_national_election, vote_nextelection_de, voted_party_last_election_de,
# certainty_party_to_vote, ranking_party_de, bundeskanzler_candidate, frequent_sharing_of_politicalviews
# clean NAs (might be interesting to look for a pattern in NAs in this question)
Dalia.March <- Dalia.March %>% filter(!is.na(vote_nextelection_de))
# rename variables
Dalia.March$vote_nextelection_de <- str_replace(Dalia.March$vote_nextelection_de,
"(\\s.+lands)|(\\s.+land)|(CDU.+le\\s)|(Die\\s)|(\\s.+Partei)|(B.+Die\\s)",
"")
Dalia.March$vote_nextelection_de <- str_replace(Dalia.March$vote_nextelection_de,
"Gr端nen", "Gruene")
Dalia.March$vote_nextelection_de <- str_replace(Dalia.March$vote_nextelection_de,
"I would not vote", "No vote")
Dalia.March$gndr <- Dalia.March$gndr %>% mapvalues(c("female", "male"), c("Female", "Male"))
# Dalia.March$bundeskanzler_candidate %>% table()
# Dalia.March$vote_nextelection_de %>% table()
### March data mining ---------------------------------------------------------
# Charts
ggplot(data = Dalia.March, mapping = aes(x = vote_nextelection_de, weight = weight)) +
geom_bar()
ggplot(data = Dalia.March, mapping = aes(x = vote_nextelection_de)) +
geom_bar(aes(fill = gndr))
ggplot(data = Dalia.March, mapping = aes(x = fct_infreq(vote_nextelection_de))) +
geom_bar(aes(fill = certainty_party_to_vote))
# -> Dalia weights cause hardly any changes
### Strata construction Dalia march -------------------------------------------------
Dalia.March$AgeGroup <- c("18-25", "26-35",
"36-45", "46-60", "60+")[findInterval(Dalia.March$age,
c(-Inf, 25.5, 35.5, 45.5, 60.5, Inf))]
Strata.1.March <- Dalia.March %>% filter(vote_nextelection_de != "No vote") %>%
group_by(gndr, AgeGroup, vote_nextelection_de) %>%
tally()
# strata percentages
Strata.1.March$n <- 100*(Strata.1.March$n/sum(Strata.1.March$n))
### Exit poll Strata ----------------------------------------------------------
# load weighting data
load("./Processed/Vote_Age_Gender_2013.RData")
load("./Processed/Total_2013.RData")
# AfD - share of total "Others"
AfD <- total.2013[8,"Zweitstimmen_pct"]/(total.2013[8,"Zweitstimmen_pct"]+
total.2013[6,"Zweitstimmen_pct"])
# compute AfD share from their total vote share across all "Other" parties:
# assumption: Distribution of voters across age groups AND gender equal
# alternative solution: collect demographics of AfD voter data
AfDShares <- data.frame(Parties = rep("AfD", 3), gndr = c("Total", "Male", "Female"),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)),
"18-25" = as.numeric(rep(NA, 3)), stringsAsFactors = FALSE)
VoteAgeGndr.2013 <- data.frame(rbind(as.matrix(VoteAgeGndr.2013), as.matrix(AfDShares)),
stringsAsFactors = FALSE)
VoteAgeGndr.2013[,c(3:8)] <- sapply(VoteAgeGndr.2013[,c(3:8)], as.double)
VoteAgeGndr.2013[VoteAgeGndr.2013$Parties == "AfD", c(3:8)] <-
VoteAgeGndr.2013[VoteAgeGndr.2013$Parties == "Other", c(3:8)]*(as.double(AfD))
VoteAgeGndr.2013[VoteAgeGndr.2013$Parties == "Other", c(3:8)] <-
VoteAgeGndr.2013[VoteAgeGndr.2013$Parties == "Other", c(3:8)]*(1-as.double(AfD))
# combine CDU/CSU
VoteAgeGndr.2013 <- VoteAgeGndr.2013 %>% mutate(
Parties = str_replace(Parties, "CDU|CSU", "Union")
) %>% group_by(gndr, Parties) %>%
summarise_all(sum) %>% filter(gndr != "Total")
# reshape
Strata.1.ExitPoll <- select(VoteAgeGndr.2013, -GndrVote) %>%
gather(key = "AgeGroup", value = "VoteShare", starts_with("age"))
Strata.1.ExitPoll$AgeGroup <- mapvalues(Strata.1.ExitPoll$AgeGroup,
c("age18_25.2013", "age26_35.2013", "age36_45.2013", "age46_60.2013", "age60..2013"),
c("18-25", "26-35", "36-45", "46-60", "60+"))
Strata.1.ExitPoll$VoteShare <- Strata.1.ExitPoll$VoteShare*100
Strata.1.ExitPoll <- rename(Strata.1.ExitPoll, VoteShareExit = VoteShare)
Strata.1.March <- rename(
Strata.1.March, Parties = vote_nextelection_de, VoteShareDalia = n)
### compute weights
exitPollWeights <- left_join(Strata.1.ExitPoll, Strata.1.March, by = c("gndr", "Parties", "AgeGroup"))
exitPollWeights$wtGndrAgeParty <- (exitPollWeights$VoteShareExit)/exitPollWeights$VoteShareDalia
exitPollWeights <- rename(exitPollWeights, vote_nextelection_de = Parties)
# assign weights to Dalia data
Dalia.March <- left_join(Dalia.March, exitPollWeights, by = c("gndr", "vote_nextelection_de", "AgeGroup"))
### graph with new weights ----------------------------------------------------
position <- c("Union", "SPD", "Gruene", "Linke", "FDP", "AfD", "Other")
p1 <- Dalia.March %>% filter(vote_nextelection_de != "No vote") %>%
ggplot(mapping = aes(x = vote_nextelection_de)) +
theme_classic() +
scale_x_discrete(limits = rev(position), name = "Major Parties") +
scale_y_continuous(name = "Overall Vote Share", limits = c(0,0.42),
breaks = c(0, 0.1, 0.2, 0.3, 0.4),
labels = percent)
p1.unweighted <- p1 +
geom_bar(aes(y = ..prop.., group = 1), fill = "cadetblue3", width = 0.8)
p1.weighted <- p1 +
geom_bar(aes(weight = wtGndrAgeParty,
y = ..prop.., group = 1),
fill = "cadetblue3",
width = 0.8)
grid.arrange(p1.unweighted, p1.weighted, ncol = 2)
